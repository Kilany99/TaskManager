<Window x:Class="TaskManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:TaskManager.Utilities"
        xmlns:local1="clr-namespace:TaskManager.Utilities.Converters"
        
        Title="Personal Task Manager" Height="450" Width="1000">
    <Window.Resources>
        <local:PriorityToColorConverter x:Key="PriorityToColorConverter"/>
        <local1:BooleanToStrikethroughConverter x:Key="BooleanToStrikethroughConverter"/>

    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="3*"/>
            <ColumnDefinition Width="1.5*"/>
        </Grid.ColumnDefinitions>

        <!-- Left Panel - Task List -->
        <DockPanel Margin="10">
            <!-- Search and Filter -->
            <StackPanel DockPanel.Dock="Top" Margin="0,0,0,10">
                <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
         Margin="0,5" Padding="5">
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Style.Resources>
                                <VisualBrush x:Key="PlaceholderBrush" TileMode="None" Opacity="0.5" Stretch="None" AlignmentX="Left">
                                    <VisualBrush.Visual>
                                        <TextBlock Text="Search tasks..." FontStyle="Italic"/>
                                    </VisualBrush.Visual>
                                </VisualBrush>
                            </Style.Resources>
                            <Style.Triggers>
                                <Trigger Property="Text" Value="{x:Null}">
                                    <Setter Property="Background" Value="{StaticResource PlaceholderBrush}"/>
                                </Trigger>
                                <Trigger Property="Text" Value="">
                                    <Setter Property="Background" Value="{StaticResource PlaceholderBrush}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>
                <ComboBox ItemsSource="{Binding CategoryManager.Categories}"
          SelectedItem="{Binding SelectedCategory}"
          DisplayMemberPath="Name"
          Margin="0,5" >
                    <ComboBox.Style>
                        <Style TargetType="ComboBox">
                            <Style.Triggers>
                                <Trigger Property="SelectedItem" Value="{x:Null}">
                                    <Setter Property="Text" Value="Filter by category"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ComboBox.Style>
                </ComboBox>

                <!-- And for the tag filter ComboBox -->
                <ComboBox ItemsSource="{Binding AvailableTags}"
          SelectedItem="{Binding SelectedFilterTag}"
          DisplayMemberPath="Name"
          Margin="0,5">
                    <ComboBox.Style>
                        <Style TargetType="ComboBox">
                            <Style.Triggers>
                                <Trigger Property="SelectedItem" Value="{x:Null}">
                                    <Setter Property="Text" Value="Filter by tag"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ComboBox.Style>
                </ComboBox>
            </StackPanel>

            <!-- Task List -->
            <ListView ItemsSource="{Binding FilteredTasks}"
                      SelectedItem="{Binding SelectedTask}">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <CheckBox IsChecked="{Binding IsCompleted}" 
                                      VerticalAlignment="Center"
                                      Margin="0,0,10,0"/>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="{Binding Title}" 
                                         FontWeight="Bold"
                                         TextDecorations="{Binding IsCompleted, 
                                            Converter={StaticResource BooleanToStrikethroughConverter}}"/>
                                <TextBlock Text="{Binding Category.Name}" 
                                         Foreground="Gray"
                                         FontSize="11"/>
                            </StackPanel>

                            <TextBlock Grid.Column="2"
                                     Text="{Binding DueDate, StringFormat='dd MMM yyyy'}"
                                     Margin="10,0"/>

                            <Rectangle Grid.Column="3"
                                     Width="16" Height="16"
                                     Fill="{Binding Priority, 
                                        Converter={StaticResource BooleanToStrikethroughConverter}}"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </DockPanel>

        <!-- Middle Panel - Task Details -->
        <StackPanel Grid.Column="1" Margin="10">
            <TextBlock Text="Task Details" 
                     FontSize="18" 
                     FontWeight="Bold" 
                     Margin="0,0,0,10"/>

            <!-- Title -->
            <TextBox Text="{Binding SelectedTask.Title, 
                     UpdateSourceTrigger=PropertyChanged, 
                     ValidatesOnDataErrors=True}"
                     Margin="0,5" Padding="5"
                     FontSize="16"/>

            <!-- Description -->
            <TextBlock Text="Description" Margin="0,5,0,2"/>
            <TextBox Text="{Binding SelectedTask.Description}"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     Height="100"
                     Margin="0,0,0,10"
                     Padding="5"/>

            <!-- Due Date -->
            <TextBlock Text="Due Date" Margin="0,5,0,2"/>
            <DatePicker SelectedDate="{Binding SelectedTask.DueDate, 
                       ValidatesOnDataErrors=True}"
                       />

            <!-- Priority -->
            <ComboBox ItemsSource="{Binding PriorityValues}"
          SelectedItem="{Binding SelectedTask.Priority}"
          Margin="0,0,0,10">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <Rectangle Width="16" Height="16" Margin="0,0,5,0"
                          Fill="{Binding Converter={StaticResource PriorityToColorConverter}}"/>
                            <TextBlock Text="{Binding}"/>
                        </StackPanel>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>

            <!-- Category -->
            <TextBlock Text="Category" Margin="0,5,0,2"/>
            <ComboBox ItemsSource="{Binding CategoryManager.Categories}"
                      SelectedItem="{Binding SelectedTask.Category}"
                      DisplayMemberPath="Name"
                      Margin="0,0,0,10"/>
        </StackPanel>

        <!-- Right Panel - Actions -->
        <StackPanel Grid.Column="2" Margin="10">
            <Button Content="Add Task" Command="{Binding AddCommand}" Margin="0,0,0,10"/>
            <Button Content="Delete Task" Command="{Binding DeleteCommand}" Margin="0,0,0,10"/>
            <Button Content="Save Task" Command="{Binding SaveCommand}" Margin="0,0,0,10"/>
        </StackPanel>
    </Grid>
</Window>
